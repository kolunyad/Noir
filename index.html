<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Sunny & Bunny: Jazz Empire Quest</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: "Georgia", serif;
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      line-height: 1.6;
      display: flex;
      flex-direction: row;
    }
     #portraits {
      width: 200px;
      margin-right: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    #portraits img {
      width: 200px;
      height: auto;
      border: 2px solid #555;
      margin-bottom: 20px;
    }
    #content {
      flex: 1;
    }
    #story {
      white-space: pre-line;
      margin-bottom: 20px;
    }
    #story img {
      max-width: 100%;
      margin: 10px 0;
      border: 2px solid #555;
    }
    button {
      display: block;
      margin: 10px auto;
      padding: 12px 20px;
      font-size: 16px;
      background: #333;
      color: #eee;
      border: 1px solid #555;
      cursor: pointer;
    }
    button:hover {
      background: #555;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="portraits">
    <img src="img/bunny.jpg" alt="Банни">
    <img src="img/sunny.jpg" alt="Санни">
  </div>
  <div id="content">
    <h1>Sunny & Bunny: Jazz Empire Quest</h1>
    <div id="story"></div>
    <div id="choices"></div>
  </div>

  <script>
    const storyEl = document.getElementById('story');
    const choicesEl = document.getElementById('choices');
    const historyStack = [];
    
    // Переменная для отслеживания найденных подсказок
    let hasClue = false;

    function show(text, choices = [], img = null) {
      storyEl.textContent = text;
      choicesEl.innerHTML = "";
      if (img) {
        const image = document.createElement("img");
        image.src = img;
        storyEl.appendChild(image);
      }
      choices.forEach(c => {
        const btn = document.createElement('button');
        btn.textContent = c.text;
        btn.onclick = () => {
          historyStack.push(() => show(text, choices, img));
          c.action();
        };
        choicesEl.appendChild(btn);
      });

      if (historyStack.length > 0) {
        const backBtn = document.createElement("button");
        backBtn.textContent = "Назад";
        backBtn.onclick = () => {
          const last = historyStack.pop();
          if (last) last();
        };
        choicesEl.appendChild(backBtn);
      }
    }

    function rollDice(successText, failText, next, successImg=null, failImg=null) {
      const roll = Math.floor(Math.random() * 10) + 1;
      let result = `🎲 Выпал кубик: ${roll}\n\n`;
      let img = null;
      
      if (roll <= 4) {  // Неудача для кубика меньше 5
        result += failText;
        img = failImg || successImg;  // Используем failImg если есть, иначе successImg
      } else {  // Успех для кубика 5+
        result += successText;
        hasClue = true;
        img = successImg;
      }
      show(result, [{text:"Дальше", action: next}], img);
    }

    // --- МЕНЮ ---
    function menu() {
      // Сброс переменных при новой игре
      hasClue = false;
      
      show(
`Санни — звезда подиума, невероятная дива, недавно получившая приглашение на закрытый бал в Empire Hall.  
Банни — журналист, детектив и мечтатель, расследующий исчезновение музыкантов из подземных джаз-клубов.  

Они давно вместе и решили, что нет места несправедливости и беззаконию в этом городе.  
Они выясняют, что бал будет не просто балом, а местом, где элита города тайно обсуждает план по установлению контроля над искусством и свободой в городе, а их задача спасти недавно похищенного Лео Монтегю.  

Их задача:  
- проникнуть на бал и найти улики, которые ведут к музыканту  
- распутать клубок тайн, шантажа и мафиозных интриг  
- спасти Лео, обладающего компроматом`,
        [{text:"Начать историю Банни и Санни", action:scene1}],
        "img/menu.jpg"
      );
    }

    // --- СЦЕНА 1 ---
    function scene1() {
      show(
`🌆 Нью-Йорк, 1925 год. Задний вход клуба "Electric Swan".  
Ветер развевает перья на вывеске, слышен саксофон изнутри.

Банни (на ушко, тревожно):  
— Ты уверена, что хочешь петь сегодня? Этот город гниёт, Санни. А кто-то хочет, чтобы ты замолчала навсегда.

Санни (улыбаясь, поправляя браслеты):  
— Я пою не для них. Я пою, для тебя и ради этого города.  
(пауза)  
— А ты уверен, что хочешь снова влезать в эту грязь?

Банни (вздыхает, оглядываясь):  
— Я не могу иначе, мы должны справиться с этим.  
— Ты — моя единственная музыка в этом проклятом городе. Я пойду за тобой.

Санни (шепчет):  
— Сегодня в VIP-зале будет мистер Вандерхольц. Он знает что-то… или кого-то.

Банни:  
— Он — та самая тень, что стоит за исчезновением Лео Монтегю, но я думаю, что тайны можно узнать в гримерке или даже в самом зале.`,
        [{text:"Войти в клуб", action:scene2}],
        "img/club.jpg"
      );
    }

    // --- СЦЕНА 2 ---
    function scene2() {
      show(
`🎭 Внутри клуба "Electric Swan".  
Санни вышла на сцену и невероятно поёт. Банни решает, как действовать. Выбор:`,
        [
          {text:"Подслушать в гримёрке", action:grim},
          {text:"Поговорить в VIP-зале с Вандерхольцем", action:vip},
          {text:"Остаться и наблюдать", action:observe}
        ],
        "img/club_inside.jpg"
      );
    }

    function grim() {
      rollDice(
        "Проверка скрытности удалась. Банни крадётся через служебный коридор к закулисью. За дверью — мужские голоса. Он подслушивает: Вандерхольц не потерпит провала. Дома у Монтегю не должно остаться улик. Эта певичка... поёт слишком чисто, ты подготовил люстру?",
        "Проверка скрытности не удалась.Банни оступается, его замечают и прогоняют, но он успел услышать, что с Санни должно что-то случится. Другой информации нет.",
        saveSunny,
        "img/grim.jpg"
      );
    }

    function vip() {
      rollDice(
        "Проверка харизмы удалась. Банни подсаживается к Вандерхольцу, и вежливо говорит: — Мне сказали, вы собираете редкие винилы. Думаю, один из них недавно привёл к… исчезновению композитора. Вандерхольц (нахмурившись, но не прогоняет): — Имя? Банни: — Лео Монтегю. Вандерхольц (улыбаясь): — Вы кое-что знаете. Это опасно... но интересно, если успеете, то давайте сыграем в игру, у Монтегю дома есть секреты, но выбирайте или ваша Санни, мы знаем, что вы спите вместе, или Монтегю.",
        "Проверка харизмы не удалась. Вандерхольц (отворачиваясь): — Я не веду дел с любителями. Охрана мягко, но твёрдо поднимает Банни и выводит его из VIP-зоны. Охранник: — Возвращайся к своему столику. Если хочешь остаться в зале и сохранить любимую",
        saveSunny,
        "img/vip.jpg"
      );
    }

    function observe() {
      rollDice(
        "Проверка внимательности удалась. Он замечает: Пианист подаёт сигнал официанту. Женщина в зелёном платье говорит что-то о доме Монтегю. Вандерхольц смотрит не на сцену, а на люстру — как будто считает минуты.",
        "Проверка внимательности не удалась. Он увлёкся голосом Санни и чуть не упустил момент. Но тревога не отпускает. Официант ставит напиток рядом — в нём короткое послание: Ты смотришь не туда",
        saveSunny,
        "img/observe.jpg"
      );
    }

    // --- СЦЕНА 3 ---
    function saveSunny() {
      show(
`🎭 На сцене Санни поет свою лучшую песню "Улетаааааюююю на Гаииитии...." под джаз. Банни замечает, что сейчас над её головой — люстра, готовая рухнуть, и никуда она не полетит.  
У Банни есть миг, чтобы спасти её.`,
        [
          {text:"Выбежать на сцену и утащить её", action: ()=>rollDice(
            "Проверка скорости Банни удалась. Банни спасает Санни, люстра рушится позади. Он рассказывает ей о том, что услышал",
            "Проверка скорости Банни не удалась. Он спасает Санни, но сам ранен. Он рассказывает ей о том, что услышал",
            house,
            "img/save1.jpg"
          )},
          {text:"Обезвредить механизм", action: ()=>rollDice(
            "Проверка ума Банни удалась. Банни перерезает трос. Люстра замирает в воздухе. Санни спасена и заканчивает любимую песню. Он рассказывает ей о том, что услышал",
            "Проверка ума Банни не удалась. Он не успевает, Санни замечает, что люстра падает и слегка отступает в сторону. Он рассказывает ей о том, что услышал",
            house,
            "img/save2.jpg"
          )},
          {text:"Предупредить взглядом", action: ()=>rollDice(
            "Проверка внимательности Санни удалась. Санни понимает жест, отходит в сторону. Люстра падает мимо. Все думают, что это шоу. Он рассказывает ей о том, что услышал",
            "Проверка внимательности Санни не удалась. Она не поняла вовремя. Во время танца она случайно отходит и падает люстра. Банни рассказывает ей о том, что услышал",
            house,
            "img/save3.jpg"
          )}
        ],
"img/saveSunny.jpg"
      );
    }

    // --- СЦЕНА 4 ---
    function house() {
      show(
`Банни рассказал Санни, что им нужно в дом Монтегю. Они быстро собираются из клуба и мчат туда, по пути заезжают за макарунами для Санни, потому что ей захотелось сладенького, Банни не смог отказать...
📍 Локация: Верхний Манхэттен, дом на пересечении 88-й и Лорел-стрит. Бывшая музыкальная резиденция Лео Монтегю — ныне закрыта, но пыль на дверной ручке говорит: здесь кто-то бывает.  
Они заходят внутрь. 

🧥 ВСТУПЛЕНИЕ

Банни (в полголоса, щёлкая зажигалкой):
— Дом, где рождалась музыка... и исчезали люди. Монтегю ушёл отсюда как гений — и пропал как улика.

Санни (глядя на окно, за которым шевелится занавеска):
— А может, он не исчез. Может, он просто слишком хорошо спрятался. Как настоящая нота, которую слышит только тот, кто любит.

Банни:
— Тогда давай сыграем правильно. Осторожно, милая. Здесь могут быть те, кто слушает.

Им нужно найти подсказку куда пропал Монтегю, времени в обрез. Есть три очевидных варианта:`,
        [
          {text:"Осмотреть салон с роялем", action: piano},
          {text:"Зайти в кабинет", action: office},
          {text:"Спуститься в подвал", action: basement}
        ],
        "img/house.jpg"
      );
    }

    function piano() {
      rollDice(
        "Проверка навыков Санни удалась. Комната с пыльным роялем Steinway. Паутина тянется от крышки до стен. На пюпитре — партитура, но с вырванной страницей. Свет пробивается из-под крышки. Санни играет лучшую мелодию Монтегю. В рояле открывается тайник: кассета с надписью Л еще дышит, ищите его в подпольном клубе Metro Echo.",
        "Проверка навыков Санни не удалась. Комната с пыльным роялем Steinway. Паутина тянется от крышки до стен. На пюпитре — партитура, но с вырванной страницей. Свет пробивается из-под крышки. Санни играет лучшую мелодию, но струна рвётся, Санни поранилась. На крышке кто-то оставил визитку подпольный клуб Metro Echo.",
        attackIntro,
        "img/piano.jpg"
      );
    }

    function office() {
      rollDice(
        "Проверка внимательности Санни удалась. Кабинет композитора, стены в обоях с нотами, на столе лежит перо, чернильница, чашка с заплесневевшим кофе. Открыт дневник. В нем Санни находит запись: Я пока жив. Ищите меня в клубе Metro Echo. Банни в это время рассматривает фигурки роботов композитора: - блин, смотри какой у него классный гандам, ты мне такой же купила - говорит он позади",
        "Проверка внимательности Санни не удалась. Кабинет композитора, стены в обоях с нотами, на столе лежит перо, чернильница, чашка с заплесневевшим кофе. Открыт дневник. Санни пытается найти запись. Банни в это время рассматривает фигурки роботов композитора: - блин, смотри какой у него классный гандам, ты мне такой же купила. Этой фразой он отвлекает ее и дневник случайно попадает в камин. Остается только часть Metro Echo",
        attackIntro,
        "img/office.jpg"
      );
    }

    function basement() {
      rollDice(
        "Проверка скорости Санни удалась. Дверь скрипит. Спускаются вниз по лестнице, вдоль стен — панели звукопоглощения, старая аппаратура. Есть Запись. Санни включает ее. На плёнке: Если ты слышишь это — значит, я жив. Metro Echo.",
        "Проверка скорости Санни не удалась. Дверь скрипит. Спускаются вниз по лестнице, вдоль стен — панели звукопоглощения, старая аппаратура. Есть Запись. Санни хочет ее включить, но Банни говорит, что тут опасно, он видит надпись Metro Echo на стене",
        attackIntro,
        "img/basement.jpg"
      );
    }

    // --- СЦЕНА 5 ---
    function attackIntro() {
      show(
        `🚪 Банни и Санни подходят к окну и замечают, что к ним идут бандиты в пальто. Их явно кто-то послал зачистить дом.  
        Банни и Санни переглядываются. Это не случайные гости. Банни говорит, что справится с ними, пусть Санни держится в стороне, Санни в этот момент замечает, что микрофоном и пластинками можно нанести нехилые увечья, но дает своему мужчине право накостылять бандитам.`,
        [{text:"Банни готовится к бою", action:attack}],
        "img/attack_intro.jpg"
      );
    }

    function attack() { 
        rollDice(
            `💪 БАННИ СПРАВЛЯЕТСЯ САМ (кубик 5+): 
            Банни (нуарно, в тени): — Вы опоздали, джентльмены. Вся ваша симфония — фальшивая. 
            Приспешник: — Твоя музыка закончится вместе с тобой. 
            Банни: (откидывает плащ, достаёт пистолет) — У меня осталась последняя нота. 
            🎯 Экшн-сцена: 
            — Банни сбивает лампу, дезориентирует врагов. 
            — Выкручивает трость, швыряет одного в пианино. 
            — Второго вырубает боком фонографа. 
            Банни (с достоинством): — Джентльмены, представление окончено.`,
            
            `🤝 САННИ ПОМОГАЕТ БАННИ (кубик меньше 5): 
           Банни (нуарно, в тени): — Вы опоздали, джентльмены. Вся ваша симфония — фальшивая. 
            Приспешник: — Твоя музыка закончится вместе с тобой.
           Банни пытается с ними справится, но они наносят ему сильные удары, он произносит (шёпотом): — Кажется, я не настолько силен, чем я думал... 
            Санни: — Гости без приглашения — мои любимые! 
            🎭 Экшн-сцена: 
            — Один приспешник хватает Банни. Начинается возня. 
            — Санни с криком швыряет микрофон на стойке. 
            — Второму запускает в лицо пластинку. Осколки ослепляют его. 
            — Банни добивает обоих с помощью стула, растрёпанный, но довольный. 
            
            После боя Банни находит записку: Убейте их обоих. — R.`,
            
            metro,
            "img/attack_success.jpg", 
            "img/attack_failed.jpg"   
        );
    }

    // --- СЦЕНА 6 ---
    function metro() {
          show(
    `📍Локация: подпольный театр "Metro Echo"
Описание: старое помещение бывшего вокзала, переделанное в элитарную сцену. Арки, колонны, занавес из бархата. Всё оформлено в готическом арт-деко, золото и чёрное дерево, дым, красные кресла. Публика — богатые и опасные. На сцене — фокусник в белых перчатках.

🎩 Главный номер — Иллюзия без голоса, в которой под видом трюка должен быть уничтожен Лео Монтегю.

🎬 НАЧАЛО СЦЕНЫ

Конферансье:
— Сегодняшний вечер завершится редчайшим трюком: исчезновение... без возвращения!
— Помолимся, чтобы наш дорогой Лео ушёл красиво, как и жил — через музыку.

📣 В зале аплодисменты.
🎼 За сценой звучит зловещий аккорд.
🪚 Лео — в позолоченной клетке, под ней — острые штыри, таймер на 3 минуты.

Банни (в полголоса, глядя сверху с балкона):
— Это не театр. Это казнь под джазовый аккомпанемент.

Санни:
— Тогда пора сыграть не по их нотам.

У героев три варианта действий:`,
            [
              {text:"Санни выходит к сцене, будто гостья-певица. Начинает петь. Песня мягкая, магнетическая, голос — гипнотизирует зал. Банни спускается за кулисы.", action: ()=>rollDice(
                "Проверка таланта Санни удалась. — Вся публика замерла. — Охрана медлит, фокусник растерян. — Банни выскальзывает к клетке, снимает замок. — Лео падает в его руки за секунду до активации ловушки.",
                "Проверка таланта Санни не удалась.— Песня действует, но не на всех. — Один из охранников замечает Банни, начинается рукопашный бой. — Лео спасён, но Банни ранен. Санни помогает сбить прожектор на нападающего.",
                finale,
                "img/metro1.jpg"
              )},
              {text:"Банни с чертежами клуба из дома Монтегю пробирается под сцену (он успел их захватить), в машинное отделение. Санни тем временем смешивается с толпой, создавая шум и путаницу репликами и коктейлями.", action: ()=>rollDice(
                "Проверка ума Банни удалась. — Банни перекусывает главный провод. Таймер гаснет. — Клетка остаётся неподвижной, трюк провален. — Санни выходит на сцену и говорит: — А теперь — настоящий финал.",
                "Проверка ума Банни не удалась.— Банни отключает не ту систему. — Срабатывает сирена, клетка начинает опускаться. — Он прыгает под неё и останавливает вручную, с кровью и рычанием.",
                finale,
                "img/metro2.jpg"
              )},
              {text:"Банни врывается через верхний занавес с револьвером и цепью. Он раскидывает охрану, спрыгивает прямо на сцену. Санни кидает в врагов со сцены: микрофоны, бокалы, даже ноты. Проверка боевых навыков", action: ()=>rollDice(
                "Проверка силы Банни удалась. — Банни вырубает всех охранников одного за другим. — Последний из врагов хватает Санни за руку. — Банни в прыжке: Отойди от моей музыки. — Удар в челюсть. — Он падает у ног Санни. Пауза. В зале — тишина. — Лео развязан. Впервые за долгое время — улыбается.",
                "Проверка силы Банни не удалась.— Банни перегружен. Его валят на пол. — Санни подбегает, хватает реквизитную саблю и отбивается. — Вместе они справляются, но Лео успевает развязаться сам, кровь на рубашке.",
                finale,
                "img/metro3.jpg"
              )}
            ],
            "img/metro.jpg"
          );
        }

    // --- ФИНАЛ ЧАСТЬ 1: ПОЛИЦИЯ ---
    function finale() {
      show(
`Локация: Театр Metro Echo — уже после финальной схватки.
Всё в дыму. Пол — усыпан разбросанными программками и осколками бокалов. В углу — обезвреженная машина пытки. На сцене — трое: Санни, Банни и Лео Монтегю. За кулисами валяются связки врагов.

🚨 Врывается полиция — в винтажной форме, с тяжелыми фонарями и пистолетами-пулемётами.

Инспектор Ламар (строго):
— Что здесь происходит?

Банни (смотрит прямо в лицо инспектору):
— Незаконная казнь, похищение, оружие и фальшивая опера.
— Обвиняемый — клуб Metro Echo и его владелец, Рой де Лили.

Он вручает полиции связку документов, найденных у телохранителей.

Инспектор Ламар:
— Вы… кто вы вообще такие?

Санни (подходит, поправляет платье, шепчет):
— Просто люди, которые не любят, когда талант убивают в прямом эфире.

💸 Финал сцены

Лео (держась за плечо, смотрит на них с благодарностью):
— Вы спасли мою жизнь. И, возможно, мою музыку.
(Достаёт из внутреннего кармана чековую книжку — чистый арт-деко, золото на чёрном.)

Лео:
— Вот. Всё, что у меня есть. Это должно хватить на новую студию… или на побег. 

Банни не знает брать или нет деньги, но Санни говорит, что они понадобятся им на отдых в теплых странах`,
        [{text:"Дальше", action:evil}],
        "img/police.jpg"
      );
    }

    // --- ФИНАЛ ЧАСТЬ 2: ЗЛОДЕЙ ---
    function evil() {
      show(
`Из тени голос в белых перчатках:  
Музыка только начинается…`,
        [{text:"Дальше", action:finaleEnd}],
        "img/evil.jpg"
      );
    }

    // --- ФИНАЛ ЧАСТЬ 3: ЭПИЛОГ ---
    function finaleEnd() {
      show(
`Локация: Дом Банни, вечер.
Тёплый интерьер в стиле ар-деко: медь, стекло, старый граммофон, мягкий свет лампы. За окном — дождь.

🎵 На проигрывателе — пластинка Санни, ее лучшие хиты.
🛋️ Банни и Санни обнимаются на диване.

Санни (садится рядом, берёт его за руку):
— Я чувствую себя… как после большого концерта.
— Всё прошло, но сердце всё ещё в напряжении.

Банни:
— Я боялся потерять тебя. Не на сцене, а там…
(Показывает на грудь.)

Санни:
— А я боялась, что ты навсегда останешься один со своим этим геройством.

Банни (улыбается):
— Ну, дива спасла героя. И забрала себе?

Санни (шепчет):
— Навсегда.

🌧️ Камера медленно уходит назад, сквозь дождь за окном.
🎼 Музыка гаснет. Тишина.  

🎷 Конец первой истории.`,
        [{text:"Далее", action:congratulations}],
        "img/finale.jpg"
      );
    }

    // --- ПОЗДРАВЛЕНИЕ ---
    function congratulations() {
      show(
`ТЫ ПРОШЛА ИГРУ, А ЕЩЕ ТЫ САМОЕ ЯРКОЕ И НАСТОЯЩЕЕ СОЛНЫШКО, АЛИСА!`,
        [{text:"Сыграть снова", action:menu}],
        "img/finale1.jpg"
      );
    }

    menu();
  </script>
</body>
</html>
